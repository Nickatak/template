services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      DEBUG: ${DOCKER_DEBUG:-True}
      SECRET_KEY: ${SECRET_KEY:-django-insecure-change-me-in-production}
      DATABASE_URL: ${DOCKER_DATABASE_URL:-sqlite:////data/db.sqlite3}
      ALLOWED_HOSTS: ${DOCKER_ALLOWED_HOSTS:-localhost,127.0.0.1,backend}
      CORS_ALLOWED_ORIGINS: ${DOCKER_CORS_ALLOWED_ORIGINS:-http://localhost:3000,http://127.0.0.1:3000}
    volumes:
      - backend_data:/data
    ports:
      - "${BACKEND_HOST_PORT:-8000}:8000"

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        NEXT_PUBLIC_API_URL: ${DOCKER_NEXT_PUBLIC_API_URL:-http://localhost:8000/api}
    depends_on:
      - backend
    environment:
      NEXT_PUBLIC_API_URL: ${DOCKER_NEXT_PUBLIC_API_URL:-http://localhost:8000/api}
    ports:
      - "${FRONTEND_HOST_PORT:-3000}:3000"

volumes:
  backend_data:
